## 技術要件（MVP：ローカル完結版）

### 1. 技術方針
- Webアプリとして実装する
- ファーストリリースはマネタイズ・ログイン・DB・APIを考慮しない
- クライアント完結型とし、静的ホスティングで動作可能とする
- 将来的なログイン・課金・DB化を見据え、責務分離を行う

---

### 2. 対応環境
- デバイス：PC / スマートフォン
- ブラウザ：最新の Chromium / Safari / Firefox
- 画面向き：**横持ち（ランドスケープ）を基本**
  - スマートフォンは横持ち前提のUIとする
  - 縦持ち時は回転を促す表示、もしくは簡易表示のみとする
- 入力：タッチ操作を前提としたUI設計

---

### 3. 採用技術
- フレームワーク：**Next.js（App Router）**
- 言語：TypeScript
- スタイリング：Tailwind CSS
- 牌素材：SVG
- パッケージ管理：npm または pnpm

※ MVP段階では状態管理ライブラリやUIライブラリは導入しない  
※ 複雑化した場合に Zustand / shadcn/ui 等を追加可能な構成とする

---

### 4. アーキテクチャ
- サーバサイド処理：なし（MVP）
- データ保存：ブラウザの localStorage
- 問題データ：アプリに同梱（`data/` 配下の JSON）

---

### 5. ディレクトリ構成・責務分割
- `app/`  
  - 画面単位のルーティング（Home / Practice / Result / Settings / Stats）
- `components/`  
  - UIコンポーネント
  - 卓UI、牌表示、回答UIなどを責務ごとに分離
- `lib/`  
  - アプリケーションロジック
  - 状態管理、問題取得、正誤判定、成績集計など
- `data/`  
  - プリセット問題データ（20問 → 100問）
- `public/`  
  - SVG牌素材（sprite方式）

---

### 6. 状態管理方針
状態を以下の3種に分けて管理する。

#### 永続設定
- 対象：ルール / 難易度 / 回答方式
- 保存先：localStorage
- 読み込み：アプリ起動時、設定画面表示時

#### 成績データ
- 対象：回答ログ（正誤、回答時間など）
- 保存先：localStorage
- 保存上限：直近一定件数（例：2,000件）でローテーション

#### プレイ中の一時状態
- 対象：出題中の問題、回答内容、演出状態など
- 管理方法：React の state
- 画面遷移時の受け渡し：sessionStorage
  - practice → result 間でのみ使用
  - 永続化はしない

---

### 7. 問題データ管理
- 形式：JSON
- 管理場所：`data/problems/`
- 問題IDは固定（例：`p0001`）
- 将来拡張に備え、スキーマバージョンを持てる設計とする

---

### 8. UX・UI 技術要件
- 数巡進行などの演出はスキップ可能
- 回答方式は設定で切替可能
  - テキスト入力
  - 選択肢式（6択）
- ツモ回答は
  - 「親の支払い」
  - 「子の支払い」
  の2入力欄に分離し、表記ゆれを防止する

---

### 9. 牌素材（SVG）管理方針
- SVG sprite方式を採用する
- 牌は1ファイルにまとめ、`<use>` により参照する
- HTTPリクエスト数を抑え、描画性能を安定させる
- 将来的なデザイン差し替えが可能な構成とする

---

### 10. パフォーマンス要件
- 初回表示（LCP）：2.5秒以内を目標
- 画面遷移：体感遅延なし（1秒未満）
- 問題データ：100問程度は初回ロードで問題なし

---

### 11. セキュリティ要件（MVP）
- 外部通信なし
- 問題データは同梱のみ
- 外部入力をHTMLとして描画しない
- 依存ライブラリの脆弱性は定期的に確認する

---

### 12. テスト要件（MVP）
- 最低限の単体テストを行う
  - 回答判定ロジック
  - localStorage の読み書き
- E2EテストはMVPでは必須としない

---

### 13. デプロイ要件
- 静的ホスティングでデプロイ可能とする
- 環境変数に依存しない
- URL更新のみでリリース可能な構成とする
