# 麻雀 点数計算仕様書（通常形・骨格）

本書は、麻雀（日本式リーチ麻雀）における**点数計算ロジックの骨格**を整理するための仕様書である。

本段階では、以下を前提とする。

* 対象は **4人麻雀**
* 和了形は **通常形（4つの面子＋1つの雀頭）のみ**
* 七対子・国士無双などの特殊形は **後続対応**
* 副露（チー・ポン・カン）を含む手を対象とする
* ローカルルール（切り上げ満貫、ダブル役満等）はここでは定義しない
* 本場（連荘棒）・供託（リーチ棒）は**考慮しない**（それらを加味した最終的な支払点数の計算ロジックは別途実装する）
* 嶺上開花、河底撈魚、海底摸月などの**特殊役**は後続対応とする

本仕様は「実装の流れを明確にすること」を目的とし、役名や専門用語の詳細定義は後工程に委ねる。

---

## 1. 点数計算の全体像

点数計算は、以下の流れで行う。

1. 入力情報の整理
2. 和了形（4面子1雀頭）の候補をすべて洗い出す
3. 各候補について、和了形の性質を整理する
4. 役の成立状況を確認する
5. 翻数を確定する
6. 符を算出する
7. 点数を計算する
8. 最も点数が高い結果を最終結果とする

以降では、それぞれの工程について説明する。

---

## 2. 入力情報

点数計算では、以下の情報を入力として受け取る。

* 手牌（上がり牌を除いた状態）
* 上がり牌
* 副露の情報（ある場合）
* 和了の種類（ツモまたはロン）
* 自風
* 場風
* 親か子か

※ 手牌と上がり牌を合わせることで、和了時点の牌構成が確定する。

---

## 3. 和了形候補の洗い出し（最重要工程）

### 3.1 基本方針

* 和了形は必ず「4つの面子と1つの雀頭」から構成される
* 同じ手牌でも、面子の組み合わせ方が複数存在する場合がある
* 点数計算では **すべての成立可能な和了形候補を列挙** し、その中から**最も点数が高いものを選択する**

### 3.2 副露の扱い

* 副露で作られた面子は、和了形の一部として **固定** する
* 副露の数に応じて、手牌側で作る必要のある面子数が決まる

例：

* 副露が2つある場合 → 残り2面子＋1雀頭を手牌から構成する

### 3.3 手牌からの分解

1. 上がり牌を含めた全牌を対象とする
2. 副露に使用されている牌を除外する
3. 残った牌から、以下を満たす組み合わせを探索する

   * 雀頭が1つ存在する
   * 残りの牌で必要数の面子が作れる

### 3.4 雀頭の決定

* 同じ牌が2枚以上ある場合、その牌を雀頭候補とする
* 雀頭候補ごとに処理を分岐し、他の組み合わせを探索する

### 3.5 面子の組み立て

* 雀頭を除いた残りの牌を使って、面子を組み立てる
* 面子は以下のいずれかとする（括弧内は一般的な呼称）

  * 連続した3枚の構成（順子）
  * 同一牌3枚の構成（刻子）
* すべての牌を使い切れた場合、その組み合わせを和了形候補とする

---

## 4. 和了形候補ごとの性質整理

列挙された各和了形候補について、後続処理で使用する情報を整理する。

整理対象の例：

* 各面子の構成内容

  * 連続した構成か、同一牌の構成か
  * 副露によるものか、手牌によるものか
  * 同一牌の構成の場合、それが副露によるものかどうかに応じて、暗刻か明刻か（暗刻＝手牌で揃えたもの／明刻＝副露で揃えたもの）を区別する
* 雀頭に使われている牌
* 上がり牌がどの部分に含まれているか
* 上がりの形（どのような待ち方だったか）

この工程では、点数計算そのものは行わない。

---

## 5. 役の成立確認

* 和了形候補の性質と、和了時の状況（ツモ／ロン、風など）を元に、成立する役を確認する
* 複数の役が同時に成立する場合がある
* 排他的な役（上位役が成立している場合に下位役を数えない等）がある場合は、ここで整理する

※ 本仕様では、具体的な役名・条件の列挙は行わない

---

## 6. 翻数の確定

* 成立した役に応じて翻数を合計する
* 副露の有無による翻数の差がある場合は反映する
* ドラによる翻数を加算する

この時点で、和了形候補ごとの合計翻数が確定する。

---

## 7. 符の算出

* 和了形候補の構成内容を元に符を積み上げる
* 符の内訳には以下が含まれる

  * 基本となる符
  * 面子の構成による符
  * 雀頭の内容による符
  * 上がり方や待ち方による符
* 最終的な符は、一定の単位で切り上げる

---

## 8. 点数の計算

* 翻数と符を元に基本点を算出する
* 親か子か、ツモかロンかに応じて支払点数を算出する
* 上位の点数区分（一定翻数以上など）がある場合は、それを優先する

---

## 9. 最終結果の決定

* 複数の和了形候補が存在する場合、最も点数が高い結果を採用する
* 同点の場合の扱いは、本仕様では定義しない（後続工程で決定）

---

## 10. 今後の拡張予定

* 七対子・国士無双などの特殊形対応
* ローカルルールの差異吸収
* 点数内訳（翻・符の詳細）の説明出力

---

本仕様書は、点数計算ロジックの土台として使用し、詳細仕様は段階的に追加していくことを想定している。
